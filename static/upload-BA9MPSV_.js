var we=Object.defineProperty,Fe=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var se=(s,o,e)=>o in s?we(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e,T=(s,o)=>{for(var e in o||(o={}))Ue.call(o,e)&&se(s,e,o[e]);if(te)for(var e of te(o))Le.call(o,e)&&se(s,e,o[e]);return s},B=(s,o)=>Fe(s,Pe(o));var N=(s,o,e)=>new Promise((c,i)=>{var u=p=>{try{b(e.next(p))}catch(E){i(E)}},f=p=>{try{b(e.throw(p))}catch(E){i(E)}},b=p=>p.done?c(p.value):Promise.resolve(p.value).then(u,f);b((e=e.apply(s,o)).next())});import{cb as ee,cc as ve,bF as me,cd as M,ce as m,cf as Q,cg as k,d as _,ch as Se,ci as K,cj as z,j as ye,i as Z,o as g,e as S,w as $,c as U,F as Te,b as Be,Q as y,u as a,ck as ge,z as R,n as h,g as H,bU as A,f as P,cl as j,cm as _e,t as ae,cn as De,P as Oe,co as je,cp as Ae,cq as qe,cr as Ne,cs as He,bZ as Ke,ct as I,cu as Me,A as Y,cv as oe,bB as ne,bC as ze,cw as Ie,cx as Ve,cy as Xe,H as le,cz as We,L as Ge,cA as Je,c7 as Qe,y as re,v as ie,cB as Ze}from"./index-DbXqjaWr.js";const he=Symbol("uploadContextKey"),Ye="ElUpload";class xe extends Error{constructor(o,e,c,i){super(o),this.name="UploadAjaxError",this.status=e,this.method=c,this.url=i}}function ue(s,o,e){let c;return e.response?c=`${e.response.error||e.response}`:e.responseText?c=`${e.responseText}`:c=`fail to ${o.method} ${s} ${e.status}`,new xe(c,e.status,o.method,s)}function et(s){const o=s.responseText||s.response;if(!o)return o;try{return JSON.parse(o)}catch(e){return o}}const tt=s=>{typeof XMLHttpRequest=="undefined"&&ee(Ye,"XMLHttpRequest is undefined");const o=new XMLHttpRequest,e=s.action;o.upload&&o.upload.addEventListener("progress",u=>{const f=u;f.percent=u.total>0?u.loaded/u.total*100:0,s.onProgress(f)});const c=new FormData;if(s.data)for(const[u,f]of Object.entries(s.data))ve(f)&&f.length?c.append(u,...f):c.append(u,f);c.append(s.filename,s.file,s.file.name),o.addEventListener("error",()=>{s.onError(ue(e,s,o))}),o.addEventListener("load",()=>{if(o.status<200||o.status>=300)return s.onError(ue(e,s,o));s.onSuccess(et(o))}),o.open(s.method,e,!0),s.withCredentials&&"withCredentials"in o&&(o.withCredentials=!0);const i=s.headers||{};if(i instanceof Headers)i.forEach((u,f)=>o.setRequestHeader(f,u));else for(const[u,f]of Object.entries(i))me(f)||o.setRequestHeader(u,String(f));return o.send(c),o},be=["text","picture","picture-card"];let st=1;const x=()=>Date.now()+st++,ke=M({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:m([Object,Function,Promise]),default:()=>Q({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:m(Array),default:()=>Q([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:be,default:"text"},httpRequest:{type:m(Function),default:tt},disabled:Boolean,limit:Number}),at=M(B(T({},ke),{beforeUpload:{type:m(Function),default:k},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:k},onChange:{type:m(Function),default:k},onPreview:{type:m(Function),default:k},onSuccess:{type:m(Function),default:k},onProgress:{type:m(Function),default:k},onError:{type:m(Function),default:k},onExceed:{type:m(Function),default:k},crossorigin:{type:m(String)}})),ot=M({files:{type:m(Array),default:()=>Q([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:k},listType:{type:String,values:be,default:"text"},crossorigin:{type:m(String)}}),nt={remove:s=>!!s},lt=_({name:"ElUploadList"}),rt=_(B(T({},lt),{props:ot,emits:nt,setup(s,{emit:o}){const e=s,{t:c}=Se(),i=K("upload"),u=K("icon"),f=K("list"),b=z(),p=ye(!1),E=Z(()=>[i.b("list"),i.bm("list",e.listType),i.is("disabled",e.disabled)]),w=v=>{o("remove",v)};return(v,D)=>(g(),S(Ke,{tag:"ul",class:y(a(E)),name:a(f).b()},{default:$(()=>[(g(!0),U(Te,null,Be(v.files,(n,l)=>(g(),U("li",{key:n.uid||n.name,class:y([a(i).be("list","item"),a(i).is(n.status),{focusing:p.value}]),tabindex:"0",onKeydown:ge(t=>!a(b)&&w(n),["delete"]),onFocus:t=>p.value=!0,onBlur:t=>p.value=!1,onClick:t=>p.value=!1},[R(v.$slots,"default",{file:n,index:l},()=>[v.listType==="picture"||n.status!=="uploading"&&v.listType==="picture-card"?(g(),U("img",{key:0,class:y(a(i).be("list","item-thumbnail")),src:n.url,crossorigin:v.crossorigin,alt:""},null,10,["src","crossorigin"])):h("v-if",!0),n.status==="uploading"||v.listType!=="picture-card"?(g(),U("div",{key:1,class:y(a(i).be("list","item-info"))},[H("a",{class:y(a(i).be("list","item-name")),onClick:A(t=>v.handlePreview(n),["prevent"])},[P(a(j),{class:y(a(u).m("document"))},{default:$(()=>[P(a(_e))]),_:1},8,["class"]),H("span",{class:y(a(i).be("list","item-file-name")),title:n.name},ae(n.name),11,["title"])],10,["onClick"]),n.status==="uploading"?(g(),S(a(De),{key:0,type:v.listType==="picture-card"?"circle":"line","stroke-width":v.listType==="picture-card"?6:2,percentage:Number(n.percentage),style:Oe(v.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):h("v-if",!0)],2)):h("v-if",!0),H("label",{class:y(a(i).be("list","item-status-label"))},[v.listType==="text"?(g(),S(a(j),{key:0,class:y([a(u).m("upload-success"),a(u).m("circle-check")])},{default:$(()=>[P(a(je))]),_:1},8,["class"])):["picture-card","picture"].includes(v.listType)?(g(),S(a(j),{key:1,class:y([a(u).m("upload-success"),a(u).m("check")])},{default:$(()=>[P(a(Ae))]),_:1},8,["class"])):h("v-if",!0)],2),a(b)?h("v-if",!0):(g(),S(a(j),{key:2,class:y(a(u).m("close")),onClick:t=>w(n)},{default:$(()=>[P(a(qe))]),_:2},1032,["class","onClick"])),h(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),h(" This is a bug which needs to be fixed "),h(" TODO: Fix the incorrect navigation interaction "),a(b)?h("v-if",!0):(g(),U("i",{key:3,class:y(a(u).m("close-tip"))},ae(a(c)("el.upload.deleteTip")),3)),v.listType==="picture-card"?(g(),U("span",{key:4,class:y(a(i).be("list","item-actions"))},[H("span",{class:y(a(i).be("list","item-preview")),onClick:t=>v.handlePreview(n)},[P(a(j),{class:y(a(u).m("zoom-in"))},{default:$(()=>[P(a(Ne))]),_:1},8,["class"])],10,["onClick"]),a(b)?h("v-if",!0):(g(),U("span",{key:0,class:y(a(i).be("list","item-delete")),onClick:t=>w(n)},[P(a(j),{class:y(a(u).m("delete"))},{default:$(()=>[P(a(He))]),_:1},8,["class"])],10,["onClick"]))],2)):h("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),R(v.$slots,"append")]),_:3},8,["class","name"]))}}));var ce=I(rt,[["__file","upload-list.vue"]]);const it=M({disabled:{type:Boolean,default:!1}}),ut={file:s=>ve(s)},Ee="ElUploadDrag",ct=_({name:Ee}),dt=_(B(T({},ct),{props:it,emits:ut,setup(s,{emit:o}){Me(he)||ee(Ee,"usage: <el-upload><el-upload-dragger /></el-upload>");const c=K("upload"),i=ye(!1),u=z(),f=p=>{if(u.value)return;i.value=!1,p.stopPropagation();const E=Array.from(p.dataTransfer.files);o("file",E)},b=()=>{u.value||(i.value=!0)};return(p,E)=>(g(),U("div",{class:y([a(c).b("dragger"),a(c).is("dragover",i.value)]),onDrop:A(f,["prevent"]),onDragover:A(b,["prevent"]),onDragleave:A(w=>i.value=!1,["prevent"])},[R(p.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}}));var ft=I(dt,[["__file","upload-dragger.vue"]]);const pt=M(B(T({},ke),{beforeUpload:{type:m(Function),default:k},onRemove:{type:m(Function),default:k},onStart:{type:m(Function),default:k},onSuccess:{type:m(Function),default:k},onProgress:{type:m(Function),default:k},onError:{type:m(Function),default:k},onExceed:{type:m(Function),default:k}})),vt=_({name:"ElUploadContent",inheritAttrs:!1}),mt=_(B(T({},vt),{props:pt,setup(s,{expose:o}){const e=s,c=K("upload"),i=z(),u=Y({}),f=Y(),b=t=>{if(t.length===0)return;const{autoUpload:d,limit:r,fileList:C,multiple:F,onStart:L,onExceed:V}=e;if(r&&C.length+t.length>r){V(t,C);return}F||(t=t.slice(0,1));for(const X of t){const q=X;q.uid=x(),L(q),d&&p(q)}},p=t=>N(this,null,function*(){if(f.value.value="",!e.beforeUpload)return w(t);let d,r={};try{const F=e.data,L=e.beforeUpload(t);r=oe(e.data)?ne(e.data):e.data,d=yield L,oe(e.data)&&ze(F,r)&&(r=ne(e.data))}catch(F){d=!1}if(d===!1){e.onRemove(t);return}let C=t;d instanceof Blob&&(d instanceof File?C=d:C=new File([d],t.name,{type:t.type})),w(Object.assign(C,{uid:t.uid}),r)}),E=(t,d)=>N(this,null,function*(){return Ve(t)?t(d):t}),w=(t,d)=>N(this,null,function*(){const{headers:r,data:C,method:F,withCredentials:L,name:V,action:X,onProgress:q,onSuccess:Re,onError:$e,httpRequest:Ce}=e;try{d=yield E(d!=null?d:C,t)}catch(O){e.onRemove(t);return}const{uid:W}=t,G={headers:r||{},withCredentials:L,file:t,data:d,method:F,filename:V,action:X,onProgress:O=>{q(O,t)},onSuccess:O=>{Re(O,t),delete u.value[W]},onError:O=>{$e(O,t),delete u.value[W]}},J=Ce(G);u.value[W]=J,J instanceof Promise&&J.then(G.onSuccess,G.onError)}),v=t=>{const d=t.target.files;d&&b(Array.from(d))},D=()=>{i.value||(f.value.value="",f.value.click())},n=()=>{D()};return o({abort:t=>{Ie(u.value).filter(t?([r])=>String(t.uid)===r:()=>!0).forEach(([r,C])=>{C instanceof XMLHttpRequest&&C.abort(),delete u.value[r]})},upload:p}),(t,d)=>(g(),U("div",{class:y([a(c).b(),a(c).m(t.listType),a(c).is("drag",t.drag),a(c).is("disabled",a(i))]),tabindex:a(i)?"-1":"0",onClick:D,onKeydown:ge(A(n,["self"]),["enter","space"])},[t.drag?(g(),S(ft,{key:0,disabled:a(i),onFile:b},{default:$(()=>[R(t.$slots,"default")]),_:3},8,["disabled"])):R(t.$slots,"default",{key:1}),H("input",{ref_key:"inputRef",ref:f,class:y(a(c).e("input")),name:t.name,disabled:a(i),multiple:t.multiple,accept:t.accept,type:"file",onChange:v,onClick:A(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}}));var de=I(mt,[["__file","upload-content.vue"]]);const fe="ElUpload",pe=s=>{var o;(o=s.url)!=null&&o.startsWith("blob:")&&URL.revokeObjectURL(s.url)},yt=(s,o)=>{const e=Xe(s,"fileList",void 0,{passive:!0}),c=n=>e.value.find(l=>l.uid===n.uid);function i(n){var l;(l=o.value)==null||l.abort(n)}function u(n=["ready","uploading","success","fail"]){e.value=e.value.filter(l=>!n.includes(l.status))}function f(n){e.value=e.value.filter(l=>l!==n)}const b=(n,l)=>{const t=c(l);t&&(console.error(n),t.status="fail",f(t),s.onError(n,t,e.value),s.onChange(t,e.value))},p=(n,l)=>{const t=c(l);t&&(s.onProgress(n,t,e.value),t.status="uploading",t.percentage=Math.round(n.percent))},E=(n,l)=>{const t=c(l);t&&(t.status="success",t.response=n,s.onSuccess(n,t,e.value),s.onChange(t,e.value))},w=n=>{me(n.uid)&&(n.uid=x());const l={name:n.name,percentage:0,status:"ready",size:n.size,raw:n,uid:n.uid};if(s.listType==="picture-card"||s.listType==="picture")try{l.url=URL.createObjectURL(n)}catch(t){We(fe,t.message),s.onError(t,l,e.value)}e.value=[...e.value,l],s.onChange(l,e.value)},v=n=>N(void 0,null,function*(){const l=n instanceof File?c(n):n;l||ee(fe,"file to be removed not found");const t=d=>{i(d),f(d),s.onRemove(d,e.value),pe(d)};s.beforeRemove?(yield s.beforeRemove(l,e.value))!==!1&&t(l):t(l)});function D(){e.value.filter(({status:n})=>n==="ready").forEach(({raw:n})=>{var l;return n&&((l=o.value)==null?void 0:l.upload(n))})}return le(()=>s.listType,n=>{n!=="picture-card"&&n!=="picture"||(e.value=e.value.map(l=>{const{raw:t,url:d}=l;if(!d&&t)try{l.url=URL.createObjectURL(t)}catch(r){s.onError(r,l,e.value)}return l}))}),le(e,n=>{for(const l of n)l.uid||(l.uid=x()),l.status||(l.status="success")},{immediate:!0,deep:!0}),{uploadFiles:e,abort:i,clearFiles:u,handleError:b,handleProgress:p,handleStart:w,handleSuccess:E,handleRemove:v,submit:D,revokeFileObjectURL:pe}},gt=_({name:"ElUpload"}),ht=_(B(T({},gt),{props:at,setup(s,{expose:o}){const e=s,c=z(),i=Y(),{abort:u,submit:f,clearFiles:b,uploadFiles:p,handleStart:E,handleError:w,handleRemove:v,handleSuccess:D,handleProgress:n,revokeFileObjectURL:l}=yt(e,i),t=Z(()=>e.listType==="picture-card"),d=Z(()=>B(T({},e),{fileList:p.value,onStart:E,onProgress:n,onSuccess:D,onError:w,onRemove:v}));return Ge(()=>{p.value.forEach(l)}),Je(he,{accept:Qe(e,"accept")}),o({abort:u,submit:f,clearFiles:b,handleStart:E,handleRemove:v}),(r,C)=>(g(),U("div",null,[a(t)&&r.showFileList?(g(),S(ce,{key:0,disabled:a(c),"list-type":r.listType,files:a(p),crossorigin:r.crossorigin,"handle-preview":r.onPreview,onRemove:a(v)},re({append:$(()=>[P(de,ie({ref_key:"uploadRef",ref:i},a(d)),{default:$(()=>[r.$slots.trigger?R(r.$slots,"trigger",{key:0}):h("v-if",!0),!r.$slots.trigger&&r.$slots.default?R(r.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)]),_:2},[r.$slots.file?{name:"default",fn:$(({file:F,index:L})=>[R(r.$slots,"file",{file:F,index:L})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0),!a(t)||a(t)&&!r.showFileList?(g(),S(de,ie({key:1,ref_key:"uploadRef",ref:i},a(d)),{default:$(()=>[r.$slots.trigger?R(r.$slots,"trigger",{key:0}):h("v-if",!0),!r.$slots.trigger&&r.$slots.default?R(r.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)):h("v-if",!0),r.$slots.trigger?R(r.$slots,"default",{key:2}):h("v-if",!0),R(r.$slots,"tip"),!a(t)&&r.showFileList?(g(),S(ce,{key:3,disabled:a(c),"list-type":r.listType,files:a(p),crossorigin:r.crossorigin,"handle-preview":r.onPreview,onRemove:a(v)},re({_:2},[r.$slots.file?{name:"default",fn:$(({file:F,index:L})=>[R(r.$slots,"file",{file:F,index:L})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0)]))}}));var bt=I(ht,[["__file","upload.vue"]]);const $t=Ze(bt);function kt(s){return new Promise(function(o){var e=new FileReader;e.readAsDataURL(s),e.onload=function(){o(this.result)}})}function Ct(s){return kt(s)}function wt(s){return new Promise(function(o){var e=new FileReader;e.readAsArrayBuffer(s),e.onload=function(){o(this.result)}})}export{$t as E,wt as a,Ct as f};
